---
title: 202501123CTF学习笔记49
date: 2025-01-23
tags:
 - CTF
 - CTFLearn
categories:
   - 命理学 Numerology
isShowComments: true
publish: true






















---

<Boxx/>

从0开始学习CTF，了解CTF基本规则、方法，这是开始打卡学习的第64天

今日内容：算法分析&传输加密&数据格式&密文存储&代码混淆&逆向保护

[[toc]]

- 小迪安全视频地址【[🔗传送门]([https://www.bilibili.com/video/BV123yAYMEwb/)】

<!-- more -->

# 第27章：算法分析&传输加密&数据格式&密文存储&代码混淆&逆向保护

## 知识点结构

- 存储密码加密-应用对象
- 传输加密编码-发送回显
- 数据传输格式-统一格式
- 代码特性混淆-开发语言



## 传输数据-编码型&加密型等

Base64是编码，MD5是加密。

### 演示案例1：

我们尝试搜索`inurl:id=mq==`，找到如下地址的网页：

```
https://indialms.in/wfp_login.php?r_id=MQ==
```

正常URL如果没有经过加密编码的话，正常是以下形式：

```
https://indialms.in/wfp_login.php?r_id=1
```

这里`MQ==`，通过加密编码工具【[CaptfEncoder](https://github.com/guyoung/CaptfEncoder)】解码以后，得出的结果就是`1`

![image-20250122205147741](/img/ctfLearn/image-20250122205147741.png)

> CaptfEncoder是一款可扩展跨平台网络安全工具套件，提供网络安全相关编码转换、古典密码、密码学、非对称加密、特殊编码、杂项等工具，并聚合各类在线工具。

此时如果我们让`id=2`，也就是直接输入一个2到地址栏，发现是访问不到的。这里我们可以通过加密我们想要的数字，就能找到对应的页面。



### 了解原因：

- 数据在传输时进行了编码，因为安全测试漏洞的时候，通常都会进行数据的修改增加再提交测试。
- 对方的服务器可能会在接受请求的时候，先解码再代入再代入，如果我们还是传入未进行加密的参数payload，传过去的参数就无法识别，也就测试无效。



### 正确的思路：

测试的时候要对payload进行和对方同样的加密后再提交。



### 案例演示2：

视频中演示的是小迪的博客后台登录页，在输入账号密码后点击提交，就能在F12开发者工具的NetWork中看到发送的请求，密码是加密过后再请求的，这里我们找一个其他需要登录的【[网站](https://iam.pt.ouchn.cn/am/UI/Login)】做替代。

![image-20250122212848452](/img/ctfLearn/image-20250122212848452.png)

通过以上方法我们发现我们传入的参数被加密了，而且是账号密码一起被加密了，我们用BurpSuite重新抓取，查看一下数据包的内容：

![image-20250122214331261](/img/ctfLearn/image-20250122214331261.png)

> 这里在用BurpSuite抓包的时候，尝试用浏览器插件代理，但发现和F12开发者工具显示的请求不一致，所以用了设置里的全局代理，应该是这个网站做了重定向，导致插件代理未生效，理论上Proxifier应该也能代理，此处需要下次注意。



### 爆破思路：

- 如果我们要进行密码爆破，面对没有加密的账号密码，直接用字典内的值进行替换即可。
- 如果密码加密后，需要我们执行密码算法，让password的值与写好的加密方式同等加密才行。



### 演示案例3：

尝试抓一下APP数据包，需要在BurpSuite打开监听WLAN局域网内IP端口，然后在模拟器中的WLAN中设置无线网络代理：

![image-20250122215944780](/img/ctfLearn/image-20250122215944780.png)

- 我们打开欢乐斗地主这个应用，发现抓到的包基本上都是经过加密的，就像是最简单的Get请求都在地址后边加上了加密后的参数，甚至连返回结果都是加密过的，这就意味着我们如果不知道加解密方式的话，是无法去测的。
- ![image-20250122220810963](/img/ctfLearn/image-20250122220810963.png)
- 所以如果是正常的、未加密的返回值，这里返回的不太正常，导致我们不清楚这个返回值是做什么的，所以我们能测的点就少，少就漏洞发现的几率就小。

像是视频上，我们也会用到一些加密的一些情况

- BiliBili的BV号应该就是经过加密的，直接就体现在视频地址中。

- 搜狐视频的地址是Base64加密的，通过Base64解码即可得到原地址。

  ```
  https://tv.sohu.com/v/MjAyNDEwMzEvbjYyMDAyMDUzMC5zaHRtbA==.html?fid=2&pvid=4d4db6d26aa0a4ec
  ```

  看到其中有Base64特征的`==`符号，我们尝试解密得到`20241031/n620020530.shtml`



### 思考：

**为什么要对参数进行加密？**

**答：**因为这样加密可以保证一些东西不被泄露，比如路径地址中带了1234这种明显数字顺序特征的地址，那我们就可以猜测会不会有1235、1236？如果把1234加密，如果我们在渗透时，看不懂加密后的样子，就看不出什么其他东西来。



### 影响：

漏洞探针-因为要搞清楚加密的方式才能按照正确的加密方式才能伪造请求去测试，针对后期做漏洞探针或者漏洞挖掘的时候，我们必须要按照固定的加密方式来伪造。



## 数据传输格式-统一格式

数据的格式有各种各样的形式，比如json、xml等。

### 案例分析

像是我们常用的Get方法，就是在地址后加`?a=1&b=2`，类似这样的参数。我们用POST方法的话，一般是json格式的参数，比如以下方式：

```json
{
  "username": "admin",
  "password": "123456"
}
```

如果我们测试PayLoad的时候，我们爆破的时候，要有的放矢，找到对应的格式对应的地方去修改（迪总讲的也太细了吧，幸好这里我学过）



### 影响：

- **发送方影响到漏洞探针**-我们需要按照特定的方式去伪造、去发送、去测漏洞，比如必须传json格式的参数，发过去看看有没有安全问题，这就设计到漏洞探针

- **回显方影响到数据分析**-回显方是对方回显过来的数据，如果是我们不了解各个格式的意思，就影响到了我们进行数据分析。包括我们有时候返回的数据是加密值，我们还要去解密出来看结果。

  **举例子：**比如我们传入了一个错误的参数，服务端应该返回错误代码，或者显示”错误“，如果这时候发现回显的数据是加密的，加密后的结果是看不出来是正确还是错误的。



### 编码&加密：

- Base64编码，推荐工具【[SRK Toolbox](https://btsrk.me/)】进行Base64编码、解码

  ```
  1经过编码后是		MQ==
  2经过编码后是		Mg==
  ```

- md5加密（视频中zblog的后台登录密码就是md5加密的），推荐工具【[CMD5](https://www.cmd5.org/)】，进行md5格式文本的解密

  ![image-20250122225605640](/img/ctfLearn/image-20250122225605640.png)



### 挖坑：

后续课程会讲解如何判断、找出这些编码、加密方法的规律



### BurpSuite参数解释：

- Host：主机地址
- Method：请求方式
- URL：路径地址
- Params：是否有参数
- Status：HTTP响应状态码
- Length：长度
- MIME type：返回格式

![image-20250122230432796](/img/ctfLearn/image-20250122230432796.png)



## 存储密码加密-应用对象

密码存储-Web&系统&三方应用

### 案例演示-zzcms：

用phpStudy搭建zzcms网站，搭建过程不再详细赘述，结果如下图所示：

![image-20250122232338372](/img/ctfLearn/image-20250122232338372.png)

在搭建的时候配置了数据库，这里数据库名zzcms，用户名zzcms，密码123456。我们用工具连接数据库，我电脑中现有的已经安装好可以用的有DataGrip，视频中演示的是Navicat，都是数据库连接工具，没有太大区别。

> DataGrip 是一款数据库管理客户端工具，方便的连接到数据库服务器，执行sql语句、创建表、创建索引以及导出数据等。DataGrip 支持几乎所有主流的关系数据库产品，如 DB2、Derby、H2、MySQL、Oracle、PostgreSQL、SQL Server、Sqllite 及 Sybase 等，并且提供了简单易用的界面，开发者上手几乎不会遇到任何困难。

![image-20250123203834697](/img/ctfLearn/image-20250123203834697.png)

我们的数据库在虚拟机中，记得需要修改user表中的root用户的host字段，主要用到的SQL语句是：

```sql
update user set host='%' where name='root'
```

如果还是连接不上，可以参考【[教程](https://blog.csdn.net/sinat_42338962/article/details/108832723)】



在数据库中，找到`zzcms_admin`这张表，我们可以看到密码是一串密文：

![image-20250123204307995](/img/ctfLearn/image-20250123204307995.png)

我们用【[CMD5](https://www.cmd5.org/)】工具进行解密，得到结果123456，我们进入到这个网站的后台管理系统，

```
http://192.168.8.21:8099/admin/login.php
```

用户名和密码是的admin和123456，我们可以成功进入后台管理系统。当然，我们也可以在数据库中将123456加密后的结果改成其他的经过md5加密后的密码。

**结论：**zzcms的后台管理系统的密码加密方式是md5。



### 案例演示-dz3.2：

部署Discuzx32到phpStudy的的WWW目录下，然后在phpStudy工具中添加网站，这里需要特别注意选php的5.4.45版本来支撑：

![image-20250123211547792](/img/ctfLearn/image-20250123211547792.png)

进入页面后进行设置，数据库名ultrax，用户名ultrax，密码123456，管理员账号admin，密码123456

我们还是用DataGrip连接找到这个ultrax数据库，找到用户这张表`pre_common_member`：

![image-20250123212509551](/img/ctfLearn/image-20250123212509551.png)

此外，还有一张`pre_ucenter_members`的表里也有password这个字段：

![image-20250123212704727](/img/ctfLearn/image-20250123212704727.png)

我们尝试解密`pre_ucenter_members`表里admin对应的密码，发现是以下情况，解密不出来：

![image-20250123212851387](/img/ctfLearn/image-20250123212851387.png)

解密不出来是因为没有加salt，俗称加盐了，我们加上数据库中的salt的值，得到`436be0fda967bc85b0245107002a835e:4241a1`，这样就能解开了：

![image-20250123213210339](/img/ctfLearn/image-20250123213210339.png)

**结论：**

- 刚才的zzcms是直接把123456加密，即`md5(123456)`
- 这里的Discuzx32的密码加密是md5加密再连接盐，即`md5(md5($pass).$salt)`

> 这个操作先对用户输入的明文密码 `$pass` 进行一次 `md5` 加密，接着把加密结果和盐值 `$salt` 连接起来，最后再对这个连接后的字符串进行一次 `md5` 加密。这样做能进一步增强密码的安全性。



### 案例演示-dz3.5：

部署Discuzx35到phpStudy的的WWW目录下，然后在phpStudy工具中添加网站，这里可以选php的7.3.4版本来支撑：

![image-20250123215752865](/img/ctfLearn/image-20250123215752865.png)

进入页面后进行设置，数据库名ultrax35，用户名ultrax35，密码123456，管理员账号admin，密码123456

![image-20250123215600481](/img/ctfLearn/image-20250123215600481.png)

发现数据库里的密码变成了新的`$2y$10$gf1l7pnn5kp/TkRWJaGpyuaY2UQh4VsOp66vSEoxz0ev9sEhCZrsu`，且加盐salt的字段变为空了



**结论：**

如果要解密这个密码，需要同时满足几种条件才可以，我们用【[CaptfEncoder](https://github.com/guyoung/CaptfEncoder)】工具打开AES加密选项

![image-20250123220403525](/img/ctfLearn/image-20250123220403525.png)

这个我们需要满足以上这几个条件才能解出来，一般这些都是写在源码里，不会出现在数据库里。



### 思考

如果我们在做安全测试的时候，使用到了AES加密，比如对请求体中传输的数据进行加密，我们是没法进行渗透测试的，因为我们密文都解不出来。一般是我们能对数据进行解密才挖漏洞，如果见到这种解不开的加密数据就不需要看了。



### 特征

- MD5值是32或16位由数字“0-9”和字母”a-f“所组成的字符串
- SHA1这种密文特征跟MD5差不多，不过位数是40
- NTLM这种加密是Windows的哈希密码，标准通讯安全协议
- AES，DES，RC4这些都是非对称加密算法，引入密钥，密文特征和Base64类似



### 案例演示-系统的加密方式：

我们用工具【[Mimikatz教程](https://blog.csdn.net/weixin_40412037/article/details/113348310)】(不建议在物理机安装，会被标记为病毒)，输入以下命令：

```shell
privilege::debug
sekurlsa::logonpasswords
```

![image-20250123223306898](/img/ctfLearn/image-20250123223306898.png)

从返回信息中找到当前用户名，这里有NTLM的哈希值`31d6cfe0d16ae931b73c59d7e0c089c0`

我们将这个密文尝试解密，发现真的可以解，只不过我这里的密码是空密码，所以解开也显示是空密码：

![image-20250123223555511](/img/ctfLearn/image-20250123223555511.png)

同样的，我们在Linux可以通过查看`cat /etc/shadow`，找到对应的密码，这里aubin就是我的用户名：

![image-20250123224311346](/img/ctfLearn/image-20250123224311346.png)

我们将其复制出来到【[CMD5](https://www.cmd5.org/)】尝试解密：

![image-20250123225941755](/img/ctfLearn/image-20250123225941755.png)

**结论：**

- 网站有他常见的加密方式、系统有他固定的加密方式，有些解密不出来可能是因为太复杂。
- MD5为什么有的可以解，有的不可以解？因为MD5是不可逆向的。
- 现在大部分的解密都是碰撞式解密，不是算法的算法的逆向还原原理。
- 平台的解密思路就是去逐位碰撞，暴力破解。有些解密不出来就是密码太复杂不好碰撞。



### 案例演示-数据库的加密方式：

我们找到MySQL的mysql数据库下，有一张叫`user`的表，表里的`authentication_string`就是密文：

![image-20250123231232402](/img/ctfLearn/image-20250123231232402.png)

将这个值复制出来，我们尝试到【[CMD5](https://www.cmd5.org/)】解密，确实能够解密出来，隐私问题我打码了：

![image-20250123231413577](/img/ctfLearn/image-20250123231413577.png)

这里标注的类型是MySql5，各个应用的加密方式都可能不太一样，我们只能讲几种常见的，可能换了以后就解密不出来了。

加密是在写程序的时候自己定义的，比如我们md5在加盐的形式上再加盐，也是种自定义的加密方式。



### 识别算法编码方法：

1. 看密文位数
2. 看密文的特征（数字、字母、大小写、符号等）
3. 看当前密文存在的地方（Web、数据库、操作系统等应用），产生地方不一样就有不一样的加密方式。



### 影响：

安全后渗透测试，即我们得到了账号密码，想要去尝试登录后台，但密码的加密方式解不出来，我们就登录不了



### 挖坑

以后我们要学习如果用平台或工具解密不出来的，有没有其他的方式解出来，比如爆破、字典等。



