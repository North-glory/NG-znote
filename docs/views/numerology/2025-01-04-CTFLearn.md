---
title: 20250104CTF学习笔记31
date: 2025-01-04
tags:
 - CTF
 - CTFLearn
categories:
   - 命理学 Numerology
isShowComments: true
publish: true

















---

<Boxx/>

从0开始学习CTF，了解CTF基本规则、方法，这是开始打卡学习的第47天

发现单纯学习CTF没有一个系统完整的课程，所以准备学小迪安全的渗透测试课程，希望能打一个好基础。

此外，还应该多参加各种CTF比赛，或者是每天练习CTF赛题，理论与实践相结合。

[[toc]]

- 小迪安全视频地址【[🔗传送门]([https://www.bilibili.com/video/BV123yAYMEwb/)】

<!-- more -->

# 第22章：Web架构&OSS存储&负载均衡&CDN加速&反向代理&WAF防护

## OSS对象存储

> 发现有很多人都在跟小迪的这套课程，在CSDN找到了一位师傅【[今天是 几号](https://blog.csdn.net/weixin_53009585?type=blog)】就是学的这套课程，甚至还在听课后做了复现，这种学习效率真的让人惊叹

**书接上回:**

我们这次上传木马1.asp的木马，木马内容是

```asp
<%eval request("pass")%>
```

这时候发现这个Web应用无法上传木马，实际上我们想讲的是即使上传成功以后

我们去访问阿里云OSS对象存储里，这个文件的详情页，有个URL地址，是互联网环境的访问地址。

在访问的时候发现，就算是访问这个后门地址也没有什么用，完全不解析，只是浏览。

**原理：**为什么要使用第三方存储

1. 静态文件会占用大量带宽
2. 加载速度
3. 存储空间

**影响：**上传的文件或解析的文件均来自OSS资源，无法解析，单独存储

1. 修复上传安全漏洞
2. 文件解析不一样
3. 但AccessKey隐患

**换位思考：**用这种方法一定程度解决了上传漏洞

**隐患：**AccessKey是云上服务的密钥或者说账号，通过这个密钥，可以控制当前阿里云账户开放的服务器或应用

![fb9d071968ee6e9ccd4ecef908aaf1fa](/img/ctfLearn/fb9d071968ee6e9ccd4ecef908aaf1fa.png)



## 反向代理

**定义：**

- 正向代理为客户端服务，客户端主动代理访问目标（不代理不可达）
- 反向代理为服务端服务，服务端主动转发数据给访问地址（不主动不可达）

![c49e8c1ad1fa339adc9f5ef7627a98b5](/img/ctfLearn/ctfLearn%5Cc49e8c1ad1fa339adc9f5ef7627a98b5.png)

上图是正向代理图，下图是反向代理图

![a9c03582077ff316ab36a5fab08d02eb](/img/ctfLearn/a9c03582077ff316ab36a5fab08d02eb.png)



**理解：**

- 比如国外代理就是正向代理，就是自己主动的找别人的让别人带出去的。
- 反向代理是服务器A把流量给到另一个服务器B上，我们是可以可以访问服务器B的，无法访问服务器A的，是服务器A主动把流量给到了服务器B上，通过访问服务器B，我们可以间接的访问服务器A。

**反向代理影响：**访问目标只是一个代理，非真实应用服务器

**演示：**Nginx反向代理配置

Windows2012+BT宝塔面板+Nginx

- 视频中，需要特别注意的是我们每添加一个站点，比如添加的`xiaodi.zero8.com`，就需要在阿里云的DNS解析中将这个地址加到解析记录里去
- 在宝塔面板直接对这个站点改一下“设置”-“反向代理”，视频中演示的是设置了一个`www.baidu.com`的反向代理
- 在访问后`xiaodi.zero8.com`，会直接跳转到`www.baidu.com`的页面，但是地址栏还是`xiaodi.zero8.com`

**结论：**

- 如果做了反向代理，如果这时候做渗透测试，我们测试的就是百度了，和网站自身没有关系。
- 通俗来说，就是将真实网站指向任何一个地方，访问起来就是别人的东西了

**注意：**正向代理和反向代理都是解决访问不可达的问题，但由于反向代理多出一个可以重定向解析的功能操作，导致反向代理出的站点指向和正式应用毫无关系！正向代理对服务器的渗透测试没有影响，是因为是在客户端在操作，对别人的服务器没有影响

**挖坑：**现阶段只要知道这个情况就行了，后续课程会针对这个反向代理的不同之处的影响和判定做解释

**拓展：**反向代理和流量跳转有什么区别？

> 正向连接、转发流量、正向代理、反向代理的区别如下：
>
> ### 正向连接
>
> - **定义**：指客户端主动向目标服务器发起的直接连接，是一种最基本的网络连接方式，客户端直接与目标服务器建立通信链路，发送请求并接收响应1。
> - **特点**：是网络通信的基础方式，通常是一对一的连接，连接建立后数据直接在客户端和目标服务器之间传输，不涉及中间服务器的额外处理。
> - **应用场景**：如用户直接访问网站、发送邮件等日常网络活动大多基于正向连接。
>
> ### 转发流量
>
> - **定义**：通常指将网络流量从一个网络位置引导至另一个网络位置，这个过程可能是通过修改域名解析、劫持网络连接或者在网页中设置跳转链接等方式来实现1。
> - **特点**：转发流量的实现方式较为多样，并不一定依赖特定的服务器架构，且在很多情况下可能是非法或未经授权的行为。
> - **应用场景**：合法的流量转发可用于网络优化、负载均衡等，如将用户对网站的访问流量引导到不同的数据中心以平衡负载；非法的流量转发常被用于流量劫持等恶意行为，如黑客通过 DNS 劫持、ARP 欺骗等手段实现流量转发，将用户引导至钓鱼网站或恶意软件下载页面等。
>
> ### 正向代理
>
> - **定义**：是位于客户端和目标服务器之间的代理服务器，客户端需明确配置代理服务器的地址和端口等信息，将请求发送给代理服务器，代理服务器再转发给目标服务器，并将目标服务器的响应返回给客户端14。
> - **特点**：主要服务于客户端，客户端知道代理服务器的存在并主动进行配置，而目标服务器通常不知道客户端的真实身份和地址，只看到代理服务器的请求。
> - **应用场景**：常用于突破网络访问限制，如访问国外网站、突破企业或学校内部网络的限制等，也可用于提高访问速度、隐藏客户端真实 IP 地址以保护隐私、进行网络监控和流量管理等1。
>
> ### 反向代理
>
> - **定义**：位于目标服务器和客户端之间，客户端向反向代理服务器发送请求，无需指定目标服务器，反向代理服务器根据策略自行选择后端的目标服务器，将请求转发给目标服务器，并把从目标服务器获取的结果返回给客户端13。
> - **特点**：主要服务于后端服务器，客户端通常不知道反向代理服务器的存在，以为自己直接访问的是目标服务器，而后端服务器知道请求来自反向代理服务器。
> - **应用场景**：广泛应用于服务器集群中，实现负载均衡和高可用性，如大型网站、电商平台、云计算平台等，还可用于缓存加速、SSL 加密卸载、安全防护等，提高系统的性能和安全性1。
>
> 与上述概念类似的有：
>
> ### 透明代理
>
> 对客户端和服务器端来说都是透明的，客户端不需要进行任何特殊配置，服务器也不知道代理的存在。透明代理通常用于监控和过滤流量，如企业内部网络中，可对员工的网络访问进行监控和管理，根据预设规则过滤掉不安全或不适当的内容79。
>
> ### Socks 代理
>
> 工作在会话层，不要求应用程序遵循特定的操作系统平台，可代理任何基于 TCP/IP 协议的应用，支持 TCP 和 UDP 协议，比 HTTP 代理更通用和灵活，通常用于通过 VPN 或 Tor 网络进行匿名访问、访问被限制的网络应用程序等。
>
> ### 端口转发
>
> 是一种将网络流量从一个端口转发到另一个端口的技术。它可以用于在网络中的不同设备之间建立通信通道，常用于内网穿透、代理服务器、负载均衡等场景，可通过路由器、交换机或软件实现5。
>
> ### 端口映射
>
> 是一种网络地址转换技术，通过在路由器或防火墙上设置映射规则，将公网 IP 的特定端口映射到内网的指定设备和端口上，主要用于服务发布、游戏联机等场景5。

## 负载均衡